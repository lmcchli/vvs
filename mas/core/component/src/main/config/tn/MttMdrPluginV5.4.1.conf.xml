<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE ltt PUBLIC "LTT" "MttMdrPluginV5.4.1.dtd">
<ltt revision="R2A" version="1.0" name="MTT MiO MDR Stream Plugin">
	<!--================================================================================================================
     Possible values: [global], true, false
     [global]: Indicate that the plugin shall be enabled/disabled according to the enabled property's value defined
     /opt/moip/common/mtt_plugin_global.properties
     true/false: Indicated that the plugin on this host shall be enabled/disabled accordingly. The value in
     in /opt/moip/common/mtt_plugin_global.properties will be ignored in this case.
     By setting the value to true or false (instead of [global]) here on a particular host, we can enable/disable
     the plugin on this particular host while the ones on the other hosts continue to be enabled/disabled according to
     the global setting. This is useful for debugging/troubleshooting purpose.
     In normal scenarios, this shall be set to [global] and the global setting will be applied on all hosts.
     //////// Even though there is no need to restart MAS/NTF for this change to take effect, it recommended to restart
     //////// MAS/NTF if you change the value of <enabled>, this is because if you disable the plugin without stopping
     //////// MAS/NTF, then CDRs generated by MAS/NTF during the period of mtt_plugin being disabled won't be written
     //////// into the MTT DB.
     ================================================================================================================-->
	<enabled>[global]</enabled> <!-- [global], true, false-->
	<!--================================================================================================================
     Possible values: [global], ALL, DEBUG, INFO, WARN, ERROR, FATAL, OFF, TRACE
     [global]: Indicate that the plugin's log level shall be set according to the loglevel property's value defined in
     /opt/moip/common/mtt_plugin_global.properties
     Other values than [global]: Indicated that the plugin's log level on this node shall be set accordingly. The value
     in /opt/moip/common/mtt_plugin_global.properties will be ignored in this case.
     By setting the value to a specific one (instead of [global]) here on a particular host, we can enable/disable
     the plugin on this particular host while the ones on the other hosts continue to use the log level set by
     the global setting. This is useful for debugging/troubleshooting purpose.
     In normal scenarios, this shall be set to [global] and the global setting will be applied on all hosts.
     //////// No need to restart MAS/NTF for this change to take effect. ////////////////////////////////////
     ================================================================================================================-->
	<loglevel>[global]</loglevel> <!-- [global], ALL, DEBUG, INFO, WARN, ERROR, FATAL, OFF, TRACE -->
	<controller>
		<config>
			<ThreadController>
				<!-- Time in milliseconds; smaller value for plugin -->
				<control>
					<wait>
						<time>100</time>
					</wait>
				</control>
				<!-- Time in milliseconds; smaller value for plugin-->
				<thread>
					<wait>
						<time>100</time>
					</wait>
				</thread>
			</ThreadController>
		</config>
	</controller>
	<parser>
		<class>
			<name>com.abcxyz.messaging.cdrgen.mtt_plugin.parse.MiOMDRParser</name>
			<rootdir>/com/abcxyz/messaging/cdrgen/mtt_plugin/parse</rootdir>
		</class>
		<config>
			<MiOMDRParser>
				<dateformat>yyyyMMdd'T'HHmmss'Z'</dateformat>
				<max_post_queue_size>52000</max_post_queue_size>
				<thread>
					<wait>
						<!-- In millisecond. For mtt_plugin, it's the MiOMDRParser's inQueue that is increasing! Do don't sleep  -->
						<time>0</time>
					</wait>
				</thread>
			</MiOMDRParser>
		</config>
	</parser>
	<postprocessor>
		<config>
			<CosPostProcessor>
				<cosfilter>
					<cos>19</cos> <!-- Put the hollandsenieuwe COS ID here (will be filtered out) -->
				</cosfilter>
			</CosPostProcessor>
		</config>
	</postprocessor>

	<storer>
		<class>
			<name>com.abcxyz.messaging.cdrgen.mtt_plugin.store.multithreaddbstorer.MultiThreadDBStorer</name>
			<rootdir>/com/abcxyz/messaging/cdrgen/mtt_plugin/store/multithreaddbstorer</rootdir>
		</class>
		<config>
			<MultiThreadDBStorer revision="R1A" version="1.0">
				<max_queue_size>10000</max_queue_size>
				<dbConnection class="com.abcxyz.messaging.cdrgen.mtt_plugin.store.multithreaddbstorer.db.yugabyte.DBStorerYugabyteFactory" >
					<config_dbconnection>
						<dbcpapiv2>
							<dbcpapi_dbname>mttdb1</dbcpapi_dbname>
							<dbcpapi_username>postgres1</dbcpapi_username>
							<dbcpapi_password>mcdproxy</dbcpapi_password>
							<dbcpapi_dbscheme>yugabytedb</dbcpapi_dbscheme>
							<dbcpapi_driver>com.yugabyte.Driver</dbcpapi_driver>
							<dbcpapi_poolprovider>hikariCP</dbcpapi_poolprovider>
							<dbcpapi_poolsize>2</dbcpapi_poolsize>
							<dbcpapi_keepalive>240000</dbcpapi_keepalive>
							<dbcpapi_disableoob>false</dbcpapi_disableoob>
							<!--========================================================================================
                            dbcpapi_dbhostlist: when it's set to [msgcoreSystems] (default), it instructs the code to use
the <DbContactPoints.List> values in /opt/global/common/msgcoreSystems.xsd|conf
Alternatively, you can specify the hostname/ip list here, separated by comma, example:
<dbcpapi_dbhostlist>gendb-1-b,gendb-2-b,gendb-1-b</dbcpapi_dbhostlist> or
<dbcpapi_dbhostlist>12.34.56.78,12.34.56.79,12.34.56,89,12.34.56.89</dbcpapi_dbhostlist>
In almost all cases, the default [msgcoreSystems] shall be used. The only case you would specify
hostname/ip is if you want to write MCDRs into the mttdb1 located on a remote site.
=========================================================================================-->
							<dbcpapi_dbhostlist>[msgcoreSystems]</dbcpapi_dbhostlist>
							<!--dbcpapi_dbport: 5433 for SQL, 9042 for CQL -->
							<dbcpapi_dbport>5433</dbcpapi_dbport>
							<dbcpapi_createconretry>2</dbcpapi_createconretry>
						</dbcpapiv2>
						<batch_size>100</batch_size>
					</config_dbconnection>
				</dbConnection>
				<storers_thread nr="2"> <!-- should be enough, as each MAS/NTF has its own MTT lib -->
					<storers>
						<storerprocessor name="MiOEvent" class="com.abcxyz.messaging.cdrgen.mtt_plugin.beans.MiOMDRBean">
							<check_for_max_days_in_db enabled="no" maxday="31" >to</check_for_max_days_in_db>
							<table>mioevent</table>
							<columns>
								<column type="NUMERIC"   name="partday">pd</column>
								<column type="VARCHAR" name="user_name" max_length="256">un</column>
								<column type="NUMERIC"   name="ma_sas_port">sp</column>
								<column type="VARCHAR" name="radius_class" max_length="80">cl</column>
								<column type="NUMERIC"   name="vendor_specific">vs</column>
								<column type="VARCHAR" name="called_station_id" max_length="80">cd</column>
								<column type="VARCHAR" name="calling_station_id" max_length="80">cg</column>
								<column type="VARCHAR" name="ma_sas_identifier" max_length="80">ni</column>
								<column type="VARCHAR" name="acct_status_type" max_length="80">ty</column>
								<column type="VARCHAR" name="acct_session_id" max_length="80">id</column>
								<column type="NUMERIC" name="acct_session_time">ti</column>
								<column type="VARCHAR" name="acct_multi_session_id" max_length="80">ms</column>
								<column type="NUMERIC" name="acct_link_count">lc</column>
								<column type="NUMERIC" name="messaging_systems_tag">it</column>
								<column type="VARCHAR" name="mae_event_type" max_length="80">et</column>
								<column type="NUMERIC" name="mae_size">sz</column>
								<column type="VARCHAR" name="mae_terminate_cause" max_length="512">tc</column>
								<column type="VARCHAR" name="mae_sas_port_type" max_length="80">pt</column>
								<column type="TIMESTAMP" name="mae_time_of_event">to</column>
								<column type="NUMERIC" name="event_nano_time">nt</column>
								<column type="VARCHAR" name="mae_object_type" max_length="80">ot</column>
								<column type="VARCHAR" name="mae_object_id" max_length="80">oi</column>
								<column type="VARCHAR" name="mae_event_description" max_length="80">ed</column>
								<column type="VARCHAR" name="mae_sss_identifier" max_length="80">si</column>
								<column type="NUMERIC" name="mae_sss_port">po</column>
								<column type="VARCHAR" name="mae_sss_port_type" max_length="80">st</column>
								<column type="VARCHAR" name="mae_message_type" max_length="80">mt</column>
								<column type="VARCHAR" name="mae_message_encoding" max_length="80">me</column>
								<column type="VARCHAR" name="mae_redirection_station_id" max_length="80">rs</column>
								<column type="VARCHAR" name="mae_event_reason" max_length="80">er</column>
								<column type="VARCHAR" name="mae_owner_name" max_length="80">on</column>
								<column type="VARCHAR" name="mae_protocol" max_length="80">pr</column>
								<column type="VARCHAR" name="mae_client_type" max_length="80">ct</column>
								<column type="VARCHAR" name="mae_delivery_report_request" max_length="80">dr</column>
								<column type="VARCHAR" name="mae_feature" max_length="80">fe</column>
								<column type="VARCHAR" name="mae_forwarded_to_id" max_length="80">ft</column>
								<column type="VARCHAR" name="mae_group_ownership" max_length="80">go</column>
								<column type="VARCHAR" name="mae_invite_type" max_length="80">in</column>
								<column type="NUMERIC" name="mae_presence_attribute">pa</column>
								<column type="VARCHAR" name="mae_presence_attribute_name" max_length="80">rc</column>
								<column type="VARCHAR" name="mae_reference_point" max_length="80">rt</column>
								<column type="VARCHAR" name="mae_result" max_length="80">re</column>
								<column type="NUMERIC" name="mae_message_content">mc</column>
								<column type="NUMERIC" name="mae_validity">va</column>
								<column type="VARCHAR" name="daylight_savings" max_length="20">daylightSavings</column>
								<!-- column type="VARCHAR" name="MAE_ACCOUNT_CURRENCY">ac</column -->
								<!-- column type="VARCHAR" name="MAE_ACCOUNT_MONEY">am</column -->
								<!-- column type="NUMERIC" name="MAE_ACCOUNT_TYPE">at</column -->
								<!-- column type="VARCHAR" name="MAE_ACCOUNT_REASON">ar</column -->
								<!-- column type="VARCHAR" name="MAE_MENU_USAGE">mu</column -->
								<column type="VARCHAR" name="mae_correlation_id">ci</column>
							</columns>
						</storerprocessor>
					</storers>
				</storers_thread>
			</MultiThreadDBStorer>
		</config>
	</storer>
</ltt>
